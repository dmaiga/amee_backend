{% extends "base_client.html" %}

{% block title %}Détail Feedback - {{ feedback.contact_request.mission.titre }}{% endblock %}

{% block content %}

<div class="max-w-4xl mx-auto space-y-6 pb-10">

    <a href="{% url 'client_feedback_list' %}" class="btn btn-ghost btn-sm gap-2 opacity-60">
        <i data-lucide="arrow-left" class="w-4 h-4"></i> Retour aux évaluations
    </a>

    <div class="card bg-base-100 shadow-sm border border-base-200 overflow-hidden">
        
        <div class="h-2 w-full {% if feedback.note >= 4 %}bg-success{% elif feedback.note == 3 %}bg-warning{% else %}bg-error{% endif %}"></div>

        <div class="card-body p-6 md:p-10">
            
            <div class="flex flex-col md:flex-row justify-between items-start gap-6">
                
                <div class="space-y-4 flex-1">
                    <div>
                        <span class="text-[10px] font-extrabold uppercase tracking-widest opacity-40">Mission évaluée</span>
                        <h1 class="text-2xl md:text-3xl font-black text-base-content tracking-tight">
                            {{ feedback.contact_request.mission.titre }}
                        </h1>
                    </div>

                    <div class="flex flex-wrap gap-4 text-sm font-medium">
                        <div class="flex items-center gap-2 px-3 py-1 bg-base-200 rounded-full">
                            <i data-lucide="user" class="w-4 h-4 opacity-50"></i>
                            {{ feedback.contact_request.consultant.get_full_name }}
                        </div>
                        <div class="flex items-center gap-2 px-3 py-1 bg-base-200 rounded-full">
                            <i data-lucide="calendar" class="w-4 h-4 opacity-50"></i>
                            {{ feedback.cree_le|date:"d F Y" }}
                        </div>
                    </div>
                </div>

                <div class="stats shadow bg-base-100 border border-base-200 w-full md:w-auto">
                    <div class="stat text-center px-8">
                        <div class="stat-title text-xs font-bold uppercase">Note globale</div>
                        <div class="stat-value text-primary flex items-center justify-center gap-2">
                            {{ feedback.note }}<span class="text-xl opacity-30">/5</span>
                        </div>
                        <div class="stat-desc mt-1">
                            <div class="rating rating-xs pointer-events-none">
                                {% for i in "12345" %}
                                    <input type="radio" class="mask mask-star-2 {% if feedback.note >= forloop.counter|add:0 %}bg-orange-400{% else %}bg-base-300{% endif %}" />
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="divider my-8"></div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                
                <div class="md:col-span-2 space-y-4">
                    <h3 class="text-lg font-bold flex items-center gap-2">
                        <i data-lucide="message-square-quote" class="text-primary w-5 h-5"></i>
                        Commentaire du client
                    </h3>
                    
                    <div class="bg-base-50 p-6 rounded-2xl border border-base-100 min-h-[150px] relative">
                        <i data-lucide="quote" class="absolute top-4 right-4 w-12 h-12 opacity-5"></i>
                        {% if feedback.commentaire %}
                            <p class="text-base-content/80 italic leading-relaxed">
                                "{{ feedback.commentaire|linebreaksbr }}"
                            </p>
                        {% else %}
                            <p class="opacity-40 italic text-center py-10">Aucun commentaire textuel n'a été laissé.</p>
                        {% endif %}
                    </div>
                </div>

                <div class="space-y-6">
                    
                    <div>
                        <h3 class="text-sm font-bold uppercase opacity-40 mb-3 tracking-widest">Sécurité & Qualité</h3>
                        {% if feedback.incident_signale %}
                            <div class="alert alert-error shadow-sm text-white font-bold animate-pulse">
                                <i data-lucide="alert-triangle"></i>
                                <span>Incident signalé</span>
                            </div>
                            <p class="text-[11px] mt-2 opacity-60 leading-tight">
                                Cet incident a été transmis automatiquement au comité de contrôle qualité de l'AMEE.
                            </p>
                        {% else %}
                            <div class="flex items-center gap-3 p-4 bg-success/10 text-success rounded-xl border border-success/20 text-sm font-bold">
                                <i data-lucide="check-circle" class="w-5 h-5"></i>
                                Aucun incident
                            </div>
                        {% endif %}
                    </div>
 
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    lucide.createIcons();
</script>

{% endblock %}