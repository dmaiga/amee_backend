{% extends "base_client.html" %}

{% block title %}Expert - {{ expert.user.get_full_name }}{% endblock %}

{% block content %}

<div class="max-w-5xl mx-auto pb-12">

    <!-- RETOUR -->
    <div class="mb-6">
        <a href="{% url 'client_experts' %}" class="btn btn-ghost btn-sm gap-2 opacity-60 hover:opacity-100">
            ← Retour à l'annuaire
        </a>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <!-- ================= SIDEBAR ================= -->
        <div class="space-y-6">

            <!-- IDENTITE -->
            <div class="card bg-base-100 shadow-sm border border-base-200">
                <div class="card-body items-center text-center p-6">

                    <div class="avatar placeholder mb-4">
                        <div class="bg-primary text-primary-content rounded-2xl w-24 h-24 text-3xl font-bold">
                            {{ expert.user.first_name|slice:":1" }}{{ expert.user.last_name|slice:":1" }}
                        </div>
                    </div>

                    <h1 class="text-xl font-extrabold">
                        {{ expert.user.get_full_name }}
                    </h1>

                    <p class="text-primary font-semibold text-sm">
                        {{ expert.public_profile.titre_professionnel }}
                    </p>

                    {% if expert.public_profile.niveau_seniorite %}
                    <p class="text-[10px] uppercase opacity-50 font-bold">
                        {{ expert.public_profile.get_niveau_seniorite_display }}
                    </p>
                    {% endif %}

                    {% if expert.user.est_recommande_amee %}
                    <div class="mt-4 badge badge-success gap-2 py-3 text-white">
                        ⭐ Recommandé AMEE
                    </div>
                    {% endif %}
                </div>
            </div>


            <!-- CONTACT -->
            <div class="card bg-base-100 shadow border border-base-200">
                <div class="card-body space-y-4">

                    <h2 class="text-sm uppercase opacity-60 font-bold">
                        Solliciter l'expert
                    </h2>

                    {% if missions_client %}
                    <form method="post" action="{% url 'request_contact_client' %}">
                        {% csrf_token %}
                        <input type="hidden" name="consultant_id" value="{{ expert.id }}">

                        <select name="mission_id"
                                class="select select-bordered w-full mb-4">
                            {% for mission in missions_client %}
                                <option value="{{ mission.id }}">
                                    {{ mission.titre }}
                                </option>
                            {% endfor %}
                        </select>

                        <button class="btn btn-primary w-full">
                            Contacter cet expert
                        </button>
                    </form>
                    {% else %}
                    <p class="text-xs opacity-60">
                        Vous devez créer une mission pour contacter un expert.
                    </p>
                    <a href="{% url 'client_mission_create' %}"
                       class="btn btn-outline btn-sm w-full">
                        Créer une mission
                    </a>
                    {% endif %}
                </div>
            </div>


            <!-- INFOS RAPIDES -->
            <div class="card bg-base-100 shadow-sm border border-base-200">
                <div class="card-body space-y-4 text-sm">

                    <div>
                        <span class="opacity-40 text-xs font-bold uppercase">
                            Disponibilité
                        </span>
                        <div class="badge badge-outline mt-1">
                            {{ expert.public_profile.get_statut_disponibilite_display }}
                        </div>
                    </div>

                    <div>
                        <span class="opacity-40 text-xs font-bold uppercase">
                            Langues
                        </span>
                        <p class="font-semibold">
                            {{ expert.public_profile.langues|default:"—" }}
                        </p>
                    </div>

                    <div>
                        <span class="opacity-40 text-xs font-bold uppercase">
                            Pays de résidence
                        </span>
                        <p class="font-semibold">
                            {{ expert.public_profile.pays_residence|default:"Mobile / International" }}
                        </p>
                    </div>

                    <div>
                        <span class="opacity-40 text-xs font-bold uppercase">
                            Nationalité
                        </span>
                        <p class="font-semibold">
                            {{ expert.public_profile.nationalite|default:"—" }}
                        </p>
                    </div>

                    <div>
                        <span class="opacity-40 text-xs font-bold uppercase">
                            Statut professionnel
                        </span>
                        <p class="font-semibold">
                            {{ expert.public_profile.get_statut_professionnel_display|default:"—" }}
                        </p>
                    </div>

                </div>
            </div>

        </div>


        <!-- ================= CONTENU PRINCIPAL ================= -->
        <div class="lg:col-span-2 space-y-6">

            <!-- PROFIL -->
            <div class="card bg-base-100 shadow-sm border border-base-200">
                <div class="card-body p-8">

                    <h2 class="text-2xl font-bold mb-6">
                        Profil professionnel
                    </h2>

                    <div class="prose max-w-none">
                        {{ expert.public_profile.resume_public|linebreaks }}
                    </div>

                    <div class="divider my-8"></div>

                    <!-- EXPERTISE -->
                    <div class="space-y-6">

                        <div>
                            <h3 class="font-bold text-primary mb-2">
                                Domaines d'expertise
                            </h3>
                            <p>{{ expert.public_profile.domaines_expertise }}</p>
                        </div>

                        <div>
                            <h3 class="font-bold text-primary mb-2">
                                Secteurs d'expérience
                            </h3>
                            <p>
                                {{ expert.public_profile.secteurs_experience|default:"Non renseigné" }}
                            </p>
                        </div>

                        <div>
                            <h3 class="font-bold text-primary mb-2">
                                Expérience géographique
                            </h3>
                            <p>
                                {{ expert.public_profile.experience_geographique|default:"—" }}
                            </p>
                        </div>

                    </div>

                </div>
            </div>


            <!-- LIENS -->
            <div class="flex gap-4 flex-wrap">

                {% if expert.public_profile.lien_linkedin %}
                <a href="{{ expert.public_profile.lien_linkedin }}"
                   target="_blank"
                   class="btn btn-outline">
                    LinkedIn
                </a>
                {% endif %}

                {% if expert.public_profile.cv_public %}
                <a href="{{ expert.public_profile.cv_public.url }}"
                   target="_blank"
                   class="btn btn-primary">
                    Télécharger le CV
                </a>
                {% elif expert.public_profile.lien_cv %}
                <a href="{{ expert.public_profile.lien_cv }}"
                   target="_blank"
                   class="btn btn-primary">
                    Voir le CV
                </a>
                {% endif %}

            </div>

        </div>

    </div>
</div>

{% endblock %}