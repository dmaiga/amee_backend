{% extends "base_client.html" %}

{% block title %}Trouver un Expert{% endblock %}

{% block content %}

<div class="max-w-7xl mx-auto space-y-8 pb-10">

    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div>
            <h1 class="text-3xl font-extrabold tracking-tight">Annuaire des experts</h1>
            <p class="opacity-60">Acc√©dez aux meilleurs consultants certifi√©s du r√©seau AMEE.</p>
        </div>
        
        {% if selected_mission %}
        <div class="alert alert-info bg-primary/10 border-primary/20 text-primary-content shadow-sm flex gap-4 py-2 px-4">
            <i data-lucide="info" class="w-5 h-5 text-primary"></i>
            <span class="text-sm font-medium">Vous cherchez pour la mission : <strong>{{ selected_mission.titre }}</strong></span>
        </div>
        {% endif %}
    </div>

    <div class="card bg-base-100 shadow-sm border border-base-200">
        <div class="card-body p-4">
            <form method="get" class="flex flex-col md:flex-row gap-4">
                {% if request.GET.mission %}
                    <input type="hidden" name="mission" value="{{ request.GET.mission }}">
                {% endif %}

                <div class="relative flex-1">
                    <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 opacity-40"></i>
                    <input type="text" name="q" value="{{ request.GET.q }}" placeholder="Nom, comp√©tence ou mot-cl√©..." class="input input-bordered w-full pl-10" />
                </div>

                <div class="relative flex-1 max-w-xs">
                    <i data-lucide="map-pin" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 opacity-40"></i>
                    <input type="text" name="localisation" value="{{ request.GET.localisation }}" placeholder="Localisation" class="input input-bordered w-full pl-10" />
                </div>

                <select name="filtre" class="select select-bordered font-medium">
                    <option value="">Tous les experts</option>
                    <option value="connus" {% if request.GET.filtre == "connus" %}selected{% endif %}>ü§ù D√©j√† collabor√©</option>
                    <option value="nouveaux" {% if request.GET.filtre == "nouveaux" %}selected{% endif %}>‚ú® Nouveaux experts</option>
                </select>

                <button class="btn btn-primary px-8">
                    Appliquer
                </button>
            </form>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">

    {% for expert in experts %}
    <div class="card bg-base-100 border border-base-200 hover:shadow-xl transition-all duration-300 group">
        
        <div class="card-body p-6">
            <div class="flex gap-4 items-start mb-4">
                <div class="avatar placeholder">
                    <div class="bg-base-200 text-base-content rounded-xl w-16 h-16 border-2 border-base-300 group-hover:border-primary/50 transition-colors">
                        <span class="text-xl font-bold">{{ expert.user.first_name|slice:":1" }}{{ expert.user.last_name|slice:":1" }}</span>
                    </div>
                </div>
                <div class="flex-1">
                    <h2 class="font-bold text-lg leading-tight group-hover:text-primary transition-colors">
                        {{ expert.user.get_full_name }}
                    </h2>
                    <p class="text-sm font-semibold text-primary/80">{{ expert.public_profile.titre_professionnel }}</p>
                    <p class="text-[10px] uppercase tracking-wider font-bold opacity-40 mt-1">
                        {{ expert.annees_experience }} ans d'exp√©rience
                    </p>

                </div>
                 {% if expert.public_profile.niveau_seniorite %}
<div class="badge badge-outline text-[10px] font-bold">
    {{ expert.public_profile.get_niveau_seniorite_display }}
</div>
{% endif %}
            </div>

            <div class="flex flex-wrap gap-2 mb-4">
                {% if expert.user.est_recommande_amee %}
                    <div class="badge badge-success gap-1 text-[10px] font-bold py-3 text-white">
                        <i data-lucide="award" class="w-3 h-3"></i> RECOMMAND√â AMEE
                    </div>
                {% endif %}
                
                {% if expert.deja_collabore %}
                    <div class="badge badge-info gap-1 text-[10px] font-bold py-3 text-white">
                        <i data-lucide="handshake" class="w-3 h-3"></i> D√âJ√Ä COLLABOR√â
                    </div>
                {% endif %}
                
                <div class="badge badge-outline gap-1 text-[10px] font-bold py-3">
                    <span class="w-2 h-2 rounded-full {% if expert.public_profile.statut_disponibilite == 'RECHERCHE' %}bg-success{% else %}bg-warning{% endif %}"></span>
                    {{ expert.public_profile.get_statut_disponibilite_display|upper }}
                </div>
            </div>

            <p class="text-sm opacity-70 line-clamp-3 min-h-[4.5rem]">
                {{ expert.public_profile.resume_public|default:"Aucune description disponible." }}
            </p>
            <p class="text-xs opacity-60 mt-2">
    {{ expert.public_profile.secteurs_experience|truncatechars:60 }}
</p>

            <div class="grid grid-cols-2 gap-2 mt-6 py-3 border-t border-b border-base-100 bg-base-50/50 rounded-lg px-2 text-[11px]">
                <div class="flex items-center gap-2">
                    <i data-lucide="globe" class="w-3 h-3 opacity-40"></i>
                    <span class="font-medium truncate">{{ expert.public_profile.langues|default:"‚Äî" }}</span>
                </div>
                <div class="flex items-center gap-2">
                    <i data-lucide="map-pin" class="w-3 h-3 opacity-40"></i>
                    <span class="font-medium truncate">{{ expert.public_profile.pays_residence }}</span>
                </div>
            </div>

            <div class="card-actions justify-between items-center mt-6">

                
                <a href="{% url 'client_expert_detail' expert.id %}" class="btn btn-primary btn-sm px-6 shadow-md">
                    Contacter
                </a>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-span-full py-16 text-center bg-base-100 rounded-3xl border-2 border-dashed border-base-300">
        <div class="flex flex-col items-center gap-4">
            <i data-lucide="users-round" class="w-16 h-16 opacity-10"></i>
            <h3 class="text-xl font-bold">Aucun expert ne correspond √† votre recherche</h3>
            <p class="opacity-50 max-w-sm mx-auto">Essayez de modifier vos filtres ou de rechercher par mots-cl√©s plus larges.</p>
            <a href="{% url 'client_experts' %}" class="btn btn-ghost">R√©initialiser les filtres</a>
        </div>
    </div>
    {% endfor %}

    </div>

</div>

<script>
    lucide.createIcons();
</script>

{% endblock %}